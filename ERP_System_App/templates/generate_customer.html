{% load static %}

<!DOCTYPE html>

<html>

<!--  ======================================================  Head Start  ======================================================  -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name=" viewport" content="width-device-width, initial-scale=1.0">

    <title>BillBoost Invoice</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="{% static 'CSS/style-1.css' %}">

    <link rel="icon" href="{% static 'Images/logo.png' %}">

</head>

<!--  ======================================================  Head End  ======================================================  -->

<!--  ======================================================  Body Start  ======================================================  -->

<body>

    <section>

        <!--  ============================================  Alert Message Start  ============================================  -->


        <!--  ============================================  Alert Message End  ============================================  -->


        <!--  ============================================  Navigation Start  ============================================  -->

        <header>

            <div class="navbar">

                <div class="aside">

                    <div class="logo">
                        <a href="#"><img src="{% static 'Images/logo.png' %}" alt=""></a>
                    </div>

                    <div class="navi">

                        <ul>

                            <li>
                                <a href="/home"><img src="{% static 'Images/dashboard.png' %}" alt="">Dashboard</a>
                            </li>

                            <li>
                                <a href="/bill_page">Bills</a>
                            </li>

                            <li>
                                <a href="/business">Customers</a>
                            </li>

                            <li><a href="/profile">
                                {% if user.is_authenticated %}
                                    <span class="username">{{ user.username }}</span>
                                {% else %}
                                    <span class="username">Guest</span>
                                {% endif %}</a>
                            </li>

                            <li>
                                {% if not request.user.is_authenticated %}

                                <h1><a href="/sign_out">Sign Out</a></h1>

                                {% else %}

                                <h1><a href="/sign_out">Sign Out</a></h1>

                                {% endif %}

                            </li>

                        </ul>

                    </div>

                </div>

            </div>

        </header>

        <!--  =======================================  Navigation End  =======================================  -->


        <!--  =======================================  Generate Bill Start  =======================================  -->

        <section>

            <div class="main-content">

                <div class="customer">

                    <form method="post" id="billForm">

                        <div class="generate-customer">

                            <h1>Add Customer</h1>

                            <div class="customer-button-head">
                                <button type="button" class="btn" onclick="window.location.href='{% url 'business' %}'">Records</button>
                            </div>

                            {% csrf_token %}

                            <div class="customer-details">

                                <div class="form-group">
                                    <label for="customer_id">Customer ID : </label>
                                    <input type="text" id="customer_id" name="customer_id" value="{{ next_id }}" placeholder="Enter Customer ID" oninput="validateNumber(this)">
                                    <h3>
                                        <div class="error-message" id="customer_id_error"></div>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label for="customer_name">Customer Name :</label>
                                    <input type="text" id="customer_name" name="customer_name" placeholder="Enter Customer Name" oninput="validateCharacterWithSpaces(this)" required>
                                    <h3>
                                        <div class="error-meesage" id="customer_name_error"></div>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label for="customer_number">Customer Number :</label>

                                    <div class="country-code">
                                        <select id="country_code" onchange="updateFlag(this)">
                                        <option value="+91" data-flag="https://flagcdn.com/w20/in.png">+91</option>
                                    </select>
                                        <img id="country_flag" src="{% static 'Images/india.webp' %}">
                                        <input type="text" id="customer_number" name="customer_number" oninput="validatePhoneNumber(this)" placeholder="Enter Customer phone number" required>
                                    </div>
                                    <h3>
                                        <div class="error-message" id="customer_number_error"></div>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label for="customer_address">Customer Address :</label>
                                    <input type="text" id="customer_address" name="customer_address" placeholder="Enter Customer Address" oninput="validateValue(this)" required>
                                    <h3>
                                        <div class="error-message" id="address_error"></div>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label for="email">Email :</label>
                                    <input type="email" id="email" name="email" placeholder="Enter Email" oninput="validateEmail(this)" required>
                                    <h3>
                                        <div class="error-message" id="email_error"></div>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label for="bill_date"> Date Of Birth : </label>
                                    <input type="date" id="date_of_birth" name="date_of_birth" oninput="calculateAge()" required>
                                    <h3>
                                        <div class="error-message" id="date_of_birth_name_error"></div>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label for="age"> Age :</label>
                                    <input type="text" id="age" name="age" readonly>
                                    <h3>
                                        <div class="error-message" id="age_error"></div>
                                    </h3>
                                </div>

                                <div class="form-group">
                                    <label for="bill_status">Gender :</label>
                                    <div class="status">
                                        <select id="gender" name="gender">
                                        <li><option  value="Male">Male</option></li>
                                        <li><option value="Female">Female</option></li>
                                        <li><option value="Other">Other</option></li>
                                    </select>
                                    </div>
                                </div>

                                <div id="alert-message" class="alert" style="display: none;">Number fields can only contain numeric values.</div>

                            </div>


                            <div class="close">
                                <button type="submit">Add Customer</button>
                                <button type="button" onclick="window.location.href='{% url 'business' %}'">Cancel</button>
                            </div>

                            <h1 id="alert-message"></h1>

                        </div>

                    </form>

                    <!--  =======================================  Generate Bill End  =======================================  -->

                </div>
            </div>

        </section>

        <!--  ======================================= Home End  =======================================  -->

        <!--  ======================================= Footer Start  =======================================  -->

        <footer>

            <div class="footer">

            </div>

        </footer>

        <!--  ======================================= Footer End  =======================================  -->

    </section>

    <script src="{% static 'JS/Script.js' %}"></script>

    <script>
        function speakMessage(message) {
            const msg = new SpeechSynthesisUtterance(message);
            // Optionally, you can set the voice to a female voice if available
            const voices = window.speechSynthesis.getVoices();
            const femaleVoice = voices.find(voice => voice.name.includes('Female')) || voices[0];
            msg.voice = femaleVoice;
            window.speechSynthesis.speak(msg);
        }

        function validateNumber(field) {
            const errorElement = document.getElementById(field.id + '_error');
            const value = field.value.trim();

            if (/[^0-9]/.test(field.value)) {
                errorElement.textContent = "Only Numbers Are Allowed...";
                errorElement.style.display = 'block';
            } else if (field.id === 'quantity' || field.id === 'price') {
                // For quantity and price, check for 0
                if (value == 0 || value === '') {
                    errorElement.textContent = "0 Or Blank Space are not allowed.";
                    errorElement.style.display = 'block';
                } else {
                    errorElement.style.display = 'none';
                }
            } else {
                errorElement.style.display = 'none';
            }
        }

        function validateCharacterWithSpaces(field) {
            const errorElement = document.getElementById(field.id + '_error');
            if (/[^a-zA-Z\s]/.test(field.value)) {
                errorElement.textContent = "Only Characters Are Allow...";
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }

        function validateProduct(field) {
            const errorElement = document.getElementById(field.id + '_error');
            errorElement.style.display = 'none'; // All values are allowed for product name
        }

        function updateFlag(selectElement) {
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            const flagUrl = selectedOption.getAttribute('data-flag');
            document.getElementById('country_flag').src = flagUrl;
        }

        function validatePhoneNumber(field) {
            const errorElement = document.getElementById(field.id + '_error');
            const countryCode = document.getElementById('country_code').value;
            let regex;

            if (countryCode === '+91') {
                regex = /^[0-9]{10}$/;
            } else if (countryCode === '+1') {
                regex = /^[0-9]{10}$/;
            } else if (countryCode === '+100') {
                regex = /^[0-9]{7,10}$/; // Example for custom country
            }

            if (!regex.test(field.value)) {
                errorElement.textContent = "Invalid Phone Number For The Selected Country...";
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }

        function validateEmail(field) {
            const errorElement = document.getElementById(field.id + '_error');
            const email = field.value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            // Validate the email address using regex
            if (!emailRegex.test(email)) {
                errorElement.textContent = "Invalid Email Address.";
                errorElement.style.display = 'block';
            } else {
                errorElement.style.display = 'none';
            }
        }


        function validateForm() {
            const fields = ['customer_name', 'customer_number', 'customer_address', 'email', 'age', 'date_of_birth', 'gender'];
            let valid = true;

            fields.forEach(function(field) {
                const element = document.getElementById(field);
                const errorElement = document.getElementById(field + '_error');

                if (element.value.trim() === "") {
                    errorElement.textContent = "Blank Space is Not Allowed...";
                    errorElement.style.display = 'block';
                    valid = false;
                } else if (errorElement.style.display === 'block') {
                    valid = false;
                } else {
                    errorElement.style.display = 'none';
                }
            });

            if (valid) {
                //alert("Form submitted successfully!");
                speakMessage("Bill Generated Successfully! Thank You...")
                    // Optionally, submit the form data here.
            } else {
                //alert("Please correct the errors and try again.");
                speakMessage("Please Correct The Errors And Try Again.")
            }
        }

        function calculateAge() {
            const dobElement = document.getElementById('date_of_birth');
            const ageElement = document.getElementById('age');

            const dobValue = dobElement.value;
            if (dobValue) {
                const dob = new Date(dobValue);
                const today = new Date();

                let age = today.getFullYear() - dob.getFullYear();
                const monthDifference = today.getMonth() - dob.getMonth();
                const dayDifference = today.getDate() - dob.getDate();

                // Adjust age if the current date is before the birthday in the current year
                if (monthDifference < 0 || (monthDifference === 0 && dayDifference < 0)) {
                    age--;
                }

                ageElement.value = age;
            } else {
                ageElement.value = '';
            }
        }

        /*function submitForm() {
            var billNumber = document.getElementById('bill_number').value;
            var customerName = document.getElementById('customer_name').value;
            var customerNumber = document.getElementById('customer_number').value;
            var product = document.getElementById('product').value;
            var quantity = document.getElementById('quantity').value;
            var price = document.getElementById('price').value;

            var valid = true;

            valid &= validateField('bill_number', billNumber, true, false);
            valid &= validateField('customer_name', customerName, false, true);
            valid &= validateField('customer_number', customerNumber, true, false);
            valid &= validateField('product', product, false, true);
            valid &= validateField('quantity', quantity, true, false);
            valid &= validateField('price', price, true, false);

            if (valid) {
                calculate();
                var speech = new SpeechSynthesisUtterance("Bill Generated Successfully..., Thank You.");
                window.speechSynthesis.speak(speech);
                alert("Bill Generated Successfully..., Thank You.");
            }
        }*/

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show';
            setTimeout(() => {
                toast.className = toast.className.replace('show', '');
            }, 3000);
        }
    </script>

</body>

<!--  ======================================================  Body End  ======================================================  -->

</html>